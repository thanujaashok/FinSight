<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <!-- <link rel="stylesheet" href="dashboard.css"> -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.8.5/dist/chart.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Styles for watchlist icon */
    /* #watchlist-icon {
        position: fixed;
        top: 20px;
        right: 20px;
        font-size: 24px;
        cursor: pointer;
        color: blue;
    } */

    /* Styles for watchlist dropdown */
    /* .watchlist-dropdown {
        display: none;
        position: fixed;
        top: 50px;
        right: 20px;
        background-color: #f9f9f9;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;
        padding: 12px;
    } */

    /* .watchlist-dropdown a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
    }

    .watchlist-dropdown a:hover {
        background-color: #f1f1f1;
    } */

    /* Include the League Spartan font */
    /* vietnamese */
    @font-face {
    font-family: 'League Spartan';
    font-style: normal;
    font-weight: 400;
    font-display: swap;
    src: url(https://fonts.gstatic.com/s/leaguespartan/v11/kJEnBuEW6A0lliaV_m88ja5Twtx8BWhtkDVmjZvM_oTZDM1dJgs.woff2) format('woff2');
    unicode-range: U+0102-0103, U+0110-0111, U+0128-0129, U+0168-0169, U+01A0-01A1, U+01AF-01B0, U+0300-0301, U+0303-0304, U+0308-0309, U+0323, U+0329, U+1EA0-1EF9, U+20AB;
    }
    /* latin-ext */
    @font-face {
    font-family: 'League Spartan';
    font-style: normal;
    font-weight: 400;
    font-display: swap;
    src: url(https://fonts.gstatic.com/s/leaguespartan/v11/kJEnBuEW6A0lliaV_m88ja5Twtx8BWhtkDVmjZvM_oTZDc1dJgs.woff2) format('woff2');
    unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }
    /* latin */
    @font-face {
    font-family: 'League Spartan';
    font-style: normal;
    font-weight: 400;
    font-display: swap;
    src: url(https://fonts.gstatic.com/s/leaguespartan/v11/kJEnBuEW6A0lliaV_m88ja5Twtx8BWhtkDVmjZvM_oTZA81d.woff2) format('woff2');
    unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }

    body {
    background-image: url("{{ url_for('static', filename='img2-3@2x.png') }}");
    /* background-color: aquamarine; */
    background-size: cover;
    background-position: center;
    font-family: 'League Spartan';
    margin: 0;
    padding: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
    }

    /* .container {
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    } */

    header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background-color: rgba(15, 66, 114, 0.6);
    padding: 10px 20px;
    box-sizing: border-box;
    z-index: 100;
    height: max-content;
    }

    h1 {
    font-size: 40px;
    color: white;
    margin: 0;
    }

    .search {
    margin-top: 1px;
    position: fixed;
    top:-10px;
    left: 55%;
    transform: translateX(-50%); 
    display: flex;
    align-items: center;
    background-color: transparent;
    padding: 10px 20px;
    border-radius: 10px;
    box-sizing: border-box;
    z-index: 100;
    }

    .search input[type="text"] {
    /* flex: 1; */
    display: flex;
    padding: 10px;
    border-radius: 5px;
    border: none;
    font-size: 16px;
    margin-right: 10px;
    width:700px;
    }

    .search button {
    background-color: transparent;
    color: #fff;
    font-size: 25px;
    font-family: 'League Spartan';
    border: 2px solid whitesmoke;
    border-radius: 10px;
    padding: 10px;
    cursor: pointer;
    height: 48px;
    }

    main {
    margin-top: 70px; /* Adjust according to header and search bar height */
    }

    .article {
    margin-top: 10px;
    margin-bottom: 15px;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 43.4px -43.4px 43.4px rgba(165, 165, 165, 0.1) inset, -43.4px 43.4px 43.4px rgba(255, 255, 255, 0.1) inset;
    background-color: rgba(15, 66, 114, 0.6);
    border: 1px solid rgba(245, 245, 245, 0.87);
    box-sizing: border-box;
    width: 700px;
    }

    h2, p, h3 {
    color: white;
    margin: 0;
    }

    h2 {
    font-size: 25px;
    text-align: center;
    }

    p {
    font-size: 16px;
    }

    h3 {
    font-size: 22px;
    }

    button {
    display: block;
    margin: 0 auto;
    background-color: transparent;
    color: #8482b7;
    font-size: 25px;
    padding: 10px 20px;
    border: 2px solid whitesmoke;
    border-radius: 10px;
    cursor: pointer;
    width: 200px;
    height: 60px;
    }

    button:hover {
    cursor: pointer;
    color: #04D2FF;
    }

    #watchlist-icon {
    position: fixed;
    top: -15px;
    right: 10px;
    width: 100px; 
    height: auto;
    z-index: 100;
    }

      /* Watchlist Dropdown CSS */
    #watchlist-dropdown {
    display: none;
    position: absolute;
    top: 50px; /* Adjust this value as needed to place the dropdown below the icon */
    right: 10px; /* Adjust this value to align with the icon */
    background-color: rgba(15, 66, 114, 0.9);
    border: 1px solid #fff;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    z-index: 200;
    width: 200px; /* Adjust the width as needed */
    padding: 10px; /* Add padding to the dropdown */
    }

    #watchlist-dropdown a {
    display: block;
    padding: 10px 20px;
    color: white;
    text-decoration: none;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    #watchlist-dropdown a:last-child {
    border-bottom: none; /* Remove the border for the last item */
    }

    #watchlist-dropdown a:hover {
    background-color: rgba(4, 210, 255, 0.8);
    }

    .logo {
    position: fixed;
    top: -15px;
    right: 10px;
    width: 100px; /* Adjust size as needed */
    height: auto;
    z-index: 100;
    }
    #articleContainer{
      margin-top: 50px;
      justify-content: center;
    }

    /* .container {
    width: 100vw; 
    max-width: none; 
    margin: 0; 
    padding: 0;
    } */

    .split-container {
    display: grid;
    margin-top: 55.5px;
    grid-template-columns: 1fr 1fr;
    height: 100vh;
    width: 100vw;
    } */



    .left-container {
    margin-top: 20px;
    padding: 20px;
    padding-top: 1050px;
    overflow-y: auto; 
    display: flex;
    flex: 1;
    justify-content: center; 
    align-items: center;

    } 




     .right-container {
        position: fixed;
    padding: 20px;
    /* background-color: rgba(15, 66, 114, 0.6);  */
    height:400px;
    left:800px;
    
    }

    #stockAnalysisContainer{
        /* top:500px;
        margin-top: 20px;
    padding: 20px;
    background-color: rgba(15, 66, 114, 0.6);
    justify-items: center; */
    top: -50px;
    margin-top: 10px;
    margin-bottom: 15px;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 43.4px -43.4px 43.4px rgba(165, 165, 165, 0.1) inset, -43.4px 43.4px 43.4px rgba(255, 255, 255, 0.1) inset;
    background-color: rgba(15, 66, 114, 0.6);
    border: 1px solid rgba(245, 245, 245, 0.87);
    box-sizing: border-box;
    width: 400px;

    }
    .article-title {
    color: white;
    font-weight:bolder;
    font-size: 26px;
    /* Add more styles as needed */
}

.sentiment{
    color: aquamarine;
    font-weight: bolder;
    font-size: larger;
}
.stock{
    display: block;
    margin: 0 auto;
    background-color: transparent;
    color: #fff;
    font-size: 25px;
    padding: 10px 20px;
    border: 2px solid whitesmoke;
    border-radius: 10px;
    cursor: pointer;
    width: 200px;
    height: 60px;

}

.stock:hover {
    cursor: pointer;
    color: #04D2FF;
    }


  </style>
</head>
<body>
  <header>
      <h1>Dashboard</h1>
      <!-- Watchlist Icon -->
      <!-- <span id="watchlist-icon" onclick="toggleWatchlist()">ðŸ“‹</span> -->
      <img id="watchlist-icon" src="{{ url_for('static', filename='justlogo-2@2x.png') }}" alt="Watchlist" onclick="toggleWatchlist()">

      <!-- Watchlist Dropdown -->
      <div id="watchlist-dropdown" class="watchlist-dropdown">
          {% for company in watchlist %}
          <a href="{{ url_for('company_analysis', company=company) }}">{{ company }}</a>
          {% endfor %}
      </div>

      <div class="search">
          <input type="text" id="searchInput" placeholder="Search...">
          <button onclick="searchArticles()">Search</button>
      </div>
  </header>
  <div class="container">
      <div class="split-container">
          <div class="left-container">
            <br>
            <h2>News Sentiment</h2>
              <main id="articleContainer">
                
                  <!-- Articles will be dynamically added here -->
              </main>
          </div>
          <div class="right-container">
            
                <h2>Stock Summary</h2>
                <div id="stockAnalysisContainer"></div>
                <button id="stock_route">Real time Stock Data</button>

          </div>
      </div>
  </div> 

  <script>

       document.getElementById("stock_route").addEventListener("click", function() {
       window.location.href = "/index"; // Redirects to the root URL, which is handled by Flask
        });
      // Function to toggle watchlist dropdown
      function toggleWatchlist() {
          var dropdown = document.getElementById("watchlist-dropdown");
          if (dropdown.style.display === "block") {
              dropdown.style.display = "none";
          } else {
              dropdown.style.display = "block";
          }
      }

      // Function to search articles
      function searchArticles() {
          var keyword = document.getElementById("searchInput").value;
          var xhr = new XMLHttpRequest();
          xhr.open("POST", "/search_news", true);
          xhr.setRequestHeader("Content-Type", "application/json");
          xhr.onreadystatechange = function () {
              if (xhr.readyState === 4 && xhr.status === 200) {
                  var response = JSON.parse(xhr.responseText);
                  if (response.status === "success") {
                      displayContent(response);
                  } else {
                      console.log("Error: " + response.message);
                  }
              }
          };
          xhr.send(JSON.stringify({ "keyword": keyword }));
      }

      function displayContent(response) {
          var articles = response[Object.keys(response).find(key => key !== "status" && key !== "stock_analysis")];
          var stockAnalysis = response.stock_analysis;

          var articleContainer = document.getElementById("articleContainer");
          articleContainer.innerHTML = ""; // Clear existing articles

          articles.forEach(function (article) {
              var section = document.createElement("section");
              section.classList.add("article");

              var title = document.createElement("h2");
              title.textContent = article.headline;
              title.classList.add("article-title");

              var description = document.createElement("p");
              description.textContent = article.description;

              var sentiment = document.createElement("h3");
              sentiment.textContent = article.sentiment;
              sentiment.colour = 'red';
              sentiment.fontWeight = 'bold';
              var viewButton = document.createElement("button");
              viewButton.textContent = "View Article";
              viewButton.onclick = function () {
                  window.open(article.link, "_blank");
              };
              sentiment.classList.add("sentiment");

              section.appendChild(title);
            
              section.appendChild(description);
              section.appendChild(sentiment);
              section.appendChild(viewButton);

              articleContainer.appendChild(section);
          });

          var stockAnalysisContainer = document.getElementById("stockAnalysisContainer");
          if (stockAnalysis) {
              stockAnalysisContainer.innerHTML = "";
              
              var greatestIncrease = document.createElement("p");
              var greatestDecrease = document.createElement("p");
              var currentClose = document.createElement("p");
              var volatility = document.createElement("p");
              var movingAverage = document.createElement("p");
            
              
              greatestIncrease.textContent = `Greatest Increase: ${stockAnalysis.greatest_increase.date} - ${stockAnalysis.greatest_increase.increase_pct}%`;
              greatestDecrease.textContent = `Greatest Decrease: ${stockAnalysis.greatest_decrease.date} - ${stockAnalysis.greatest_decrease.decrease_pct}%`;
              currentClose.textContent = `Current Close: ${stockAnalysis.current_close}`;
              volatility.textContent = `Volatility: ${stockAnalysis.volatility}`;
              movingAverage.textContent = `Moving Average (1 Month): ${stockAnalysis.moving_average_1_month}`;
              
             
              stockAnalysisContainer.appendChild(greatestIncrease);
              stockAnalysisContainer.appendChild(greatestDecrease);
              stockAnalysisContainer.appendChild(currentClose);
              stockAnalysisContainer.appendChild(volatility);
              stockAnalysisContainer.appendChild(movingAverage);
          } else {
              stockAnalysisContainer.innerHTML = "No stock data available.";
          }
      }
  </script>
</body>

</html>